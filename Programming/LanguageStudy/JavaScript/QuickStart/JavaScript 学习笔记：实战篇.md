# JavaScript 学习笔记：实战篇

> 本文部分内容节选自笔者于 2021 年出版的[《JavaScript 全栈开发》](https://book.douban.com/subject/35493728/)一书。

众所周知，网页浏览器是 JavaScript 最初的宿主环境，在浏览器端的编程（即前端编程）也是这门脚本语言应用得最为成熟的领域。而这一领域编程也是时下最热门的技术议题之一，能否充分发挥 JavaScript 语言在浏览器端强大处理能力直接关系到我们所构建的 Web 应用程序的核心竞争力。在这篇笔记中，我们将具体为读者介绍如何使用这门语言处理浏览器端的工作。

## DOM 与 BOM

在基于网页浏览器的编程环境中，我们所使用的 JavaScript 语言其实是由三部分组成的。首先是语言的核心部分：ECMAScript，再来就是用于操作 HTML 文档的文档对象模型（DOM）和用于操作浏览器部分功能的浏览器对象模型（BOM）。换而言之，我们在前端编程中主要面对的是以下两个对象模型：

- **文档对象模型**： 即 Document Object Model，简称 DOM，它是一组按照 W3C 组织的标准定义的、用于操作 HTML 及 XML 文档的应用程序接口，JavaScript 是通过这些接口来操作 Web 页面中的各种元素的。简而言之，就是 DOM 会在内存中将读取到的 HTML 或 XML 文档解释成一个树状的数据结构，然后让 JavaScript 以增、删、改、查该树形结构上节点并为其注册事件响应函数的形式来完成对 Web 页面的处理。

- **浏览器对象模型**： 即 Browser Object Model，简称 BOM，该对象模型中包含了`windows`、`navigator`、`screen`、`history`、`location`等一系列与浏览器功能相关的对象组件，JavaScript 是通过它们来实现窗口的弹出与平移、获取浏览器名称、版本号、用户的操作系统、用户机器的屏幕分辨率以及用户之前的访问记录等超出 HTML 文档范围的、Web 应用的客户端功能。当然了，由于 BOM 长期以来并没有统一的标准，每个浏览器都有自己的 BOM 实现，所以我们在使用 BOM 时经常会遇到各种兼容性问题，但读者也不必太过担心，在 HTML5 标准发布并被广泛采用之后，这个问题已经得到了很大程度的解决，如今的主流浏览器几乎都采用了相同的对象实现，这些对象的方法和属性被约定俗成地统称为 BOM 的方法和属性。

除此之外，由于前端编程面对的环境是 Web 应用程序的用户界面，界面的装饰美化也是我们需要关注的任务。因此，以 CSS 为代表的 Web 美工技术也是我们学习前端编程必须要具备的基础知识。况且，如今在 JavaScript 的具体使用中，我们在选取页面元素时也会用到不少 CSS 选择器的使用思维。当然了。本书预设读者已经掌握了从 HTML5 到 CSS3 的所有相关基础技术，这里只是强调一下它们在前端开发中的重要性，具体就不做专门的介绍了，读者如果有需要的话，请自行阅读相关资料，补足相关的基础再继续后面的学习。

> 关联笔记：[[HTML 学习笔记]] [[CSS 学习笔记]]

当然了，除了与 HTML 和 CSS 相关的基础知识之外，初学者在具体学习如何在前端环境中使用 JavaScript 之前，还需要先对网页浏览器在前端编程中所扮演的角色要有一个基本的了解。下面，我们就来简单介绍一下这部分的基础知识。

### 浏览器扮演的的角色

正如我们之前所说，要学习 Web 应用程序的开发就必须要先分清楚浏览器和服务器在 B/S 架构下各自所承担的角色，它们的分工具体如下：

- Web 服务器在 B/S 架构下所承担的角色通常被称之为 Web 应用程序的“后端”，主要负责存储并处理用户提交的请求数据，然后把响应数据返回给用户所在的 Web 浏览器。它一般用于处理较为复杂的业务逻辑，包括执行大型计算、存储海量数据等，开发与维护的成本都比较高。

- Web 浏览器在 B/S 架构下所承担的角色通常被称之为 Web 应用程序的“前端”，主要负责提供应用程序的用户操作界面，以及向 Web 服务器提交请求数据并接收来自服务器的响应数据。它一般用于处理与用户交互相关的业务逻辑，包括呈现数据、响应用户操作等。这部分的开发与维护成本主要受到浏览器的影响较大。

从上述分工可以看出，如果我们要想进行 Web 应用程序的前端开发，首先必须要熟悉应用程序主要面向的执行环境 —— 网页浏览器。就目前来说，浏览器之间差异主要来自于它们采用的渲染引擎。下面，让我们来对如今市面上主流的浏览器渲染引擎做个简单的介绍：

- **Trident**：Internet Explorer 浏览器采用的渲染引擎，除此之外，采用该渲染引擎的浏览器还有：Avant、Sleipnir、GOSURF、GreenBrowser 和 KKman 等。由于 Internet Explorer 浏览器是市占率最高的桌面操作系统 —— Windows 系统的内置浏览器，所以除非我们想开发一个小众的应用程序，否则就不能忽视采用这一引擎的浏览器。而且直到目前为止，国内主要的网上银行还都只支持 Internet Explorer 浏览器。
  
  由于 Internet Explorer 浏览器曾经长期处于垄断地位（从 Windows 95 的年代一直到 Windows XP 初期），一家独大的心态使得微软在很长一段时间内都惰于更新浏览器引擎，这让 Trident 引擎一度与 W3C 标准近乎脱节，并且累积了大量的安全性漏洞。也正因为如此，许多开发者和学者对采用这一引擎的浏览器一直都颇有微词，这客观上也促使了很多用户转向了采用其他引擎的浏览器。

- **Gecko**：最初是 Netscape 浏览器采用的渲染引擎，后来的 FireFox 浏览器也采用了这一引擎。由于 Gecko 是一款完全开源的浏览器渲染引擎，全世界的开发者都可以为其编写代码，因此受到许多人的青睐，采用 Gecko 引擎的浏览器也很多，除了被使用最多的 Firefox 浏览器，还包括 Mozilla SeaMonkey、waterfox、Iceweasel、K-Meleon 等。

- **Webkit**：最初是 Safari 浏览器采用的渲染引擎，后来的 Chrome 浏览器也采用了这一引擎 。在很长的一段时间里，该渲染引擎都只是 macOS 系统上 Safari 浏览器的专用引擎，非常小众。但随着 Safari 浏览器推出了 Windows 版，和 Chrome 浏览器的加入，以及这两款浏览器在分别在 iOS 和 Android 等移动端操作系统上所占据的主导地位，该浏览器引擎安全、稳定、快速的优势得到了极大的发挥。目前，Chrome 浏览器的市占率已经超越了 Internet Explorer，成为了浏览器领域新的领头羊。

在了解了主流浏览器采用的渲染引擎之后，我们就可以来介绍一下浏览器的工作原理了。正如我们之前所说，浏览器的主要功能就是向 Web 应用程序所在的服务器发出请求，然后在浏览器窗口中展示服务器返回来的响应数据。这里所说的响应数据一般是包括 HTML 文档、PDF 文档、图片、视频等不同类型的资源。具体来说，浏览器按照分工可以分成以下几个组成部分：

- **用户界面**：用户所请求的资源位置通常要通过 URI（统一资源标示符）的形式在浏览器的地址栏中或者用之前保存在浏览器中的书签来指定。除此之外，Web 页面的导航通常也需要通过浏览器显示区中的页面元素，或工具栏中的前进/后退按钮以及菜单栏中的历史列表来完成。这些功能都是浏览器的用户界面来提供的，它会负责将用户的请求数据交付给浏览器引擎，由后者将其发送给服务器。

- **浏览器引擎**：这一部分主要负责在用户界面和渲染引擎之间传送数据与操作指令，以及向服务器发送请求并接收响应，它是整个浏览器的调度中心。

- **页面渲染引擎**：这一部分主要负责显示响应数据的内容。具体来说，就是浏览器在收到服务器返回的响应数据之后，就会将其交给渲染引擎。如果返回的响应数据是 HTML 文档。它就负责解析 HTML 和 CSS 内容，并将解析结果排版后显示在屏幕上。如果返回的响应数据是 JavaScript 脚本代码，它就负责去调用 JavaScript 解释器，以便解释执行这些脚本代码。

- **前端数据存取**： Web 应用程序在某些情况下也会需要在客户端保存一些数据，例如用户允许浏览器记住的用户名和密码等，这时候就需要用到 Cookie 以及 HTML5 新定义的“网络数据库”这一类浏览器端的数据存储功能。

由此可以看出，所谓 Web 应用程序的前端开发，应该主要包含以下任务：

- 第一： **设计 Web 应用的用户界面**：这部分的任务包括用 HTML 来定义的网页结构，和用 CSS 来设计的网页样式。在这部分工作中，我们会决定 Web 应用要在浏览器中呈现的标题、段落、列表、表格、图片以及音乐、视频等多媒体页面元素，这是基本的，也是我们后续工作的基础所在。

- 第二： **赋予 Web 应用的用户界面与用户交互的能力**：这部分的任务包括响应网页上所有被注册了相关事件的元素，以及部分用户对浏览器本身所做的操作，譬如前进/后退的导航按钮、将某些数据存储到 Cookie 中等。这部分工作我们就主要是通过 JavaScript 这一类浏览器脚本语言来实现的。

在明确了前端开发中要完成的具体任务之后，接下来，我们就可以来具体研究如何使用 JavaScript 语言来完成这些任务了。下面，让我们先从用于操作 HTML/XML 元素的、最基础的 DOM 接口开始。

### DOM 的使用

### BOM 的使用

## 引入 jQuery
